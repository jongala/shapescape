<html>
<head>
    <meta charset="utf-8"/>
    <title>Shapescapes</title>
    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
            background: #f0f0f0;
        }
        #example {
            margin: 20px;
            position: relative;
            width: 400px;
            height: 600px;
            border: 1px solid #ddd;
            box-shadow: 0 1px 10px rgba(0, 0, 0, 0.2);
        }
        #example canvas {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

        #example {}

        #saved {
            position: fixed;
            border-left: 1px solid #ccc;
            top: 0;
            right: 0;
            bottom: 0;
            width: 50%;
            overflow: auto;
        }

        #saved > img {
            margin: 10px;
            box-shadow: 0 1px 10px rgba(0, 0, 0, 0.2);
            width: 200px;
        }

        #controls {
            position: absolute;
            bottom: 0;
            left: 0;
            padding: 0.5em 20px;
        }

        #controls button {
            padding: 0 1em;
            line-height: 3em;
            color: #000;
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 0.2em;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div id="example"></div>
    <div id="saved"></div>
    <div id="controls">
        <button onclick="createBatch(9)" id="newBatchTrigger">New Batch</button>
    </div>
    <script src="js/shapescape.js"></script>
    <script src="3p/DAT.GUI.min.js"></script>
    <script type="text/javascript">


        // Obj/array helpers
        function extend(dest, src) {
            for (k in src) {
                if (src.hasOwnProperty(k)) {
                    dest[k] = src[k];
                }
            }
            return dest;
        }

        function objToArray(obj) {
            var arr = [];
            for (key in obj) {
                if (obj.hasOwnProperty(key)) {
                    arr.push(obj[key]);
                }
            }
            return arr;
        }

        function arrayToObj(arr) {
            var obj = {};
            arr.forEach(function(val, i){
                obj[i] = val;
            });
            return obj;
        }

        // Examples and controls

        // Default Palette
        DEFAULT_PALETTE = ["#ff0099", "#774aa4", "#3399cc", "#ffcc00"];



        // GUI controlled opts
        var visualOpts = {
            container: document.querySelector('#example'),
            clear: true
        };


        var exampleNode = document.getElementById('example');


        function loadOpts(opts) {
            visualOpts = extend(visualOpts, opts);
            shapescape(visualOpts);
        }

        loadOpts({});

        document.addEventListener('keypress', function(e) {
            var kode = e.which || e.keyCode;
            if (kode === 32) {
                requestAnimationFrame(loadOpts);
            }
        });

        function saveCanvas(canvas, container) {
            var pixels = canvas.toDataURL('image/png');
            var image = document.createElement('img');
            image.src = pixels;
            container.appendChild(image);
        }

        document.addEventListener('click', function(e) {
            if (e.target.nodeName === 'CANVAS') {
                saveCanvas(e.target, document.querySelector('#saved'));
            }
        });

        function createBatch(N) {
            N = N || 10;
            var canvas = document.querySelector('#example canvas');
            var container = document.querySelector('#saved');
            container.innerHTML = '';
            for (var i=0; i < N ; i++) {
                requestAnimationFrame(function(){
                    loadOpts();
                    saveCanvas(canvas, container);
                });
            }
        }

        document.querySelector('#newBatchTrigger').focus();



    </script>
</body>
</html>